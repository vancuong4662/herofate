# Frontend Architecture

> ƒê∆∞·ª£c t√°ch ra t·ª´ README.md ch√≠nh ƒë·ªÉ d·ªÖ qu·∫£n l√Ω v√† tra c·ª©u

## 1. Gi·ªõi thi·ªáu chung

**Hero Fate** l√† m·ªôt web game online ƒë∆°n gi·∫£n, ƒë∆∞·ª£c thi·∫øt k·∫ø nh∆∞ m·ªôt d·ª± √°n h·ªçc t·∫≠p ƒë·ªÉ h·ªçc vi√™n m·ªõi b·∫Øt ƒë·∫ßu h·ªçc l·∫≠p tr√¨nh c√≥ th·ªÉ th·ª±c h√†nh theo. Game c√≥ l·ªëi ch∆°i nh·∫π nh√†ng, g·ªìm hai ph·∫ßn ch√≠nh: **x√¢y d·ª±ng th·ªã tr·∫•n** v√† **chi·∫øn ƒë·∫•u theo l∆∞·ª£t (turn-based)**.

**üéÆ Enhanced Navigation Bar:**
- **User Stats**: C·∫•p ƒë·ªô, V√†ng, EXP, Danh ti·∫øng v·ªõi icons  
- **Player Info Button**: N√∫t "Th√¥ng tin" m·ªü modal chi ti·∫øt v·ªÅ player
- **Navigation Actions**: Th·ªã tr·∫•n, Nhi·ªám v·ª•, Kho ƒë·ªì, ƒêƒÉng xu·∫•t
- **Clean Layout**: Streamlined horizontal bar without avatar clutter

**üìã Player Info Modal (NEW):**
- **Trigger**: Click n√∫t "Th√¥ng tin" trong navigation bar
- **Layout**: Modal n·∫±m ngang v·ªõi 2 c·ªôt ch√≠nh
  - **Left Side**: Player avatar (128x128 canvas) + username
  - **Right Side**: Stats grid v·ªõi 10 th√¥ng s·ªë (Level, Gold, EXP, Reputation, STR, AGI, INT, VIT, WIS, Crit Rate)
- **Animation**: Configurable idle animation ch·ªâ ch·∫°y khi modal m·ªü
- **Auto-close**: Animation t·ª± ƒë·ªông d·ª´ng khi ƒë√≥ng modal
- **Professional**: Centered layout v·ªõi proper spacing

**ÔøΩ Player Animation System (ENHANCED):**
- **GML.js Integration**: S·ª≠ d·ª•ng th∆∞ vi·ªán t·ª± t·∫°o cho sprite animation
- **Canvas Rendering**: 128x128 canvas v·ªõi idle animation full-size
- **Configurable Speed**: Animation speed c√≥ th·ªÉ ƒëi·ªÅu ch·ªânh qua JavaScript
- **Control Functions**:
  - `setAnimationSpeed(speed)`: ƒêi·ªÅu ch·ªânh t·ªëc ƒë·ªô (0.05-0.3)
  - `setAnimationPreset(preset)`: S·ª≠ d·ª•ng preset ('slow', 'normal', 'fast')
  - `getAnimationSpeed()`: L·∫•y t·ªëc ƒë·ªô hi·ªán t·∫°i
  - `startPlayerAnimation()` / `stopPlayerAnimation()`: Control animation
- **On-demand**: Animation ch·ªâ ch·∫°y khi Player Info Modal m·ªü
- **Performance**: Efficient memory usage v·ªõi conditional rendering th·ªÉ th·ª±c h√†nh theo. Game c√≥ l·ªëi ch∆°i nh·∫π nh√†ng, g·ªìm hai ph·∫ßn ch√≠nh: **x√¢y d·ª±ng th·ªã tr·∫•n** v√† **chi·∫øn ƒë·∫•u theo l∆∞·ª£t (turn-based)**.
- Khi thi·∫øu nhi·ªám v·ª•, h·ªá th·ªëng t·ª± th√™m m·ªõi t·ª´ file JSON
- N√∫t "B·∫Øt ƒë·∫ßu" s·∫Ω chuy·ªÉn sang `/battle` (thay v√¨ navigation tr·ª±c ti·∫øp)

### D. Chi·∫øn ƒë·∫•u theo l∆∞·ª£t (`/battle`) - Protected Route

- D·∫°ng 1 vs 1, lu√¢n phi√™n
- K·∫ª ƒë·ªãch x√°c ƒë·ªãnh qua `battle_enemy` (t·ª´ localStorage)  
- G·ªçi API l·∫•y d·ªØ li·ªáu enemy t·ª´ JSON
- **Ch·ªâ truy c·∫≠p t·ª´ quests**: Kh√¥ng c√≥ direct navigation button

### E. H·ªôi tho·∫°i (`/dialog/<id>/<quest_id>`) - Protected Routeation Bar:**
- **Player Avatar**: Canvas animation v·ªõi male_idle.png (4 frames, 128x128 ‚Üí 64x64)
- **User Stats**: C·∫•p ƒë·ªô, V√†ng, EXP, Danh ti·∫øng v·ªõi icons
- **Navigation Actions**: Th·ªã tr·∫•n, Nhi·ªám v·ª•, Kho ƒë·ªì, ƒêƒÉng xu·∫•t
- **Integrated Layout**: Single horizontal bar thay v√¨ multiple sections

**üèóÔ∏è Buildings Grid:**
- C√°c c√¥ng tr√¨nh ƒë∆∞·ª£c render d·∫°ng card theo grid 3 c·ªôt
- Hover ƒë·ªÉ xem t√™n, click m·ªü modal t∆∞∆°ng ·ª©ng
- T√≤a th·ªã ch√≠nh m·ªü `/quests`
- C√≥ n√∫t "X√¢y d·ª±ng" ƒë·ªÉ hi·ªán danh s√°ch c√¥ng tr√¨nh c√≥ th·ªÉ x√¢y

**üé® Player Animation System:**
- **GML.js Integration**: S·ª≠ d·ª•ng th∆∞ vi·ªán t·ª± t·∫°o cho sprite animation
- **Canvas Rendering**: 64x64 canvas v·ªõi idle animation
- **Frame Management**: 4 frames v·ªõi t·ªëc ƒë·ªô 0.2, loop t·ª± ƒë·ªông
- **Fallback**: Icon üë§ n·∫øu kh√¥ng load ƒë∆∞·ª£c sprite·ªõi b·∫Øt ƒë·∫ßu h·ªçc l·∫≠p tr√¨nh c√≥ th·ªÉ th·ª±c h√†nh theo. Game c√≥ l·ªëi ch∆°i nh·∫π nh√†ng, g·ªìm hai ph·∫ßn ch√≠nh: **x√¢y d·ª±ng th·ªã tr·∫•n** v√† **chi·∫øn ƒë·∫•u theo l∆∞·ª£t (turn-based)**.

D·ª± √°n s·ª≠ d·ª•ng c√¥ng ngh·ªá ph·ªï bi·∫øn, ƒë∆°n gi·∫£n, d·ªÖ h·ªçc v√† d·ªÖ tri·ªÉn khai.

---


## 4. Frontend Libraries & Animation System

### 4.1. GML.js - Game Maker Language JavaScript
**GML.js** l√† th∆∞ vi·ªán sprite animation t·ª± ph√°t tri·ªÉn, l·∫•y c·∫£m h·ª©ng t·ª´ GameMaker Studio:

```javascript
// T·∫°o sprite v·ªõi 4 frames animation
const playerSprite = spriteCreate(
    '/static/img/player/male_idle.png', 
    128,    // sprite width
    128,    // sprite height  
    4,      // number of frames
    64,     // origin x
    64      // origin y
);

// T·∫°o instance c·ªßa sprite
const playerInstance = instCreate(x, y, 0, playerSprite);
playerInstance.imageSpeed = 0.15;  // Animation speed
playerInstance.imageLoop = true;   // Loop animation
```

**T√≠nh nƒÉng ch√≠nh:**
- **Sprite Management**: Load v√† qu·∫£n l√Ω sprite sheets
- **Frame Animation**: H·ªó tr·ª£ multi-frame animation v·ªõi t·ªëc ƒë·ªô c√≥ th·ªÉ ƒëi·ªÅu ch·ªânh
- **Instance System**: T·∫°o v√† qu·∫£n l√Ω multiple instances c·ªßa c√πng m·ªôt sprite
- **Canvas Rendering**: Render sprites l√™n HTML5 Canvas
- **Performance Optimized**: Ch·ªâ render khi c·∫ßn thi·∫øt

### 4.2. Support.js - Utility Functions
**Support.js** ch·ª©a c√°c helper functions v√† utilities:

```javascript
// Toast notification system
showToast(message, type);  // 'success', 'error', 'warning', 'info'

// API call wrapper v·ªõi error handling
apiCall(endpoint, options);

// User data management
getUserData();
updateUserInfoDisplay(userData);

// Level calculation t·ª´ EXP
calculateLevel(exp);

// Modal management
closeModal();
```

**Ch·ª©c nƒÉng ch√≠nh:**
- **Toast System**: Th√¥ng b√°o user-friendly
- **API Wrapper**: X·ª≠ l√Ω HTTP requests v·ªõi error handling
- **Data Management**: LocalStorage v√† session management  
- **UI Utilities**: Modal controls, form validation
- **Game Logic**: Level calculation, stat management

### 4.3. Player Animation Integration
```javascript
// Animation control functions
setAnimationSpeed(speed);        // 0.05 - 0.3
setAnimationPreset(preset);      // 'slow', 'normal', 'fast'
getAnimationSpeed();             // Get current speed
startPlayerAnimation();          // Start animation
stopPlayerAnimation();           // Stop animation

// Configuration object
const ANIMATION_CONFIG = {
    FRAME_SPEED: 0.1,
    FRAME_COUNT: 4,
    CANVAS_SIZE: 128,
    SPRITE_SIZE: 128,
    AUTO_START: false
};
```

---


## 5. Modal System & UI Standards

### 5.1. Modal Structure Standards
T·∫•t c·∫£ modals trong game tu√¢n theo c·∫•u tr√∫c 3 ph·∫ßn chu·∫©n:

```html
<div id="modalName" class="modal">
    <div class="modal-content">
        <!-- Modal Header -->
        <div class="modal-header">
            <h2 class="modal-title">
                <i class="fas fa-icon"></i> Ti√™u ƒë·ªÅ Modal
            </h2>
            <button class="modal-close" onclick="closeModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <!-- Modal Body -->
        <div class="modal-body">
            <!-- N·ªôi dung ch√≠nh c·ªßa modal -->
        </div>
        
        <!-- Modal Footer -->
        <div class="modal-footer">
            <button class="btn btn-primary">H√†nh ƒë·ªông ch√≠nh</button>
            <button class="btn btn-secondary" onclick="closeModal()">ƒê√≥ng</button>
        </div>
    </div>
</div>
```

### 5.2. Modal Sizing Standards
```css
/* Standard modal */
.modal-content {
    max-width: 700px;
    width: 85%;
}

/* Large modal (cho inventory, player info) */
.inventory-modal .modal-content {
    max-width: 900px;
    width: 95%;
}

/* Player info modal */
.player-info-modal {
    max-width: 750px;
    width: 90%;
}
```

### 5.3. Button Consistency
```css
/* Modal footer buttons lu√¥n ƒë∆∞·ª£c cƒÉn gi·ªØa v√† c√≥ kho·∫£ng c√°ch ƒë·ªÅu */
.modal-footer {
    display: flex;
    justify-content: center;
    gap: var(--spacing-md);
}

/* Button styling standards */
.btn-primary {
    background: var(--primary-color);
}

.btn-secondary {
    background: var(--primary-color-light);
}
```

---


## 8. UI/UX Improvements

### 8.1. Visual Design
- **Header**: Background image t·ª´ `static/img/background/1.jpg`
- **Building System**: 
  - H√¨nh ·∫£nh building t·ª´ `static/img/building/{building_id}.png`
  - Ground texture: `static/img/building/ground.png`
  - Building images ƒë∆∞·ª£c scale 2x ƒë·ªÉ n·ªïi b·∫≠t
- **Visual States**: 
  - ƒê√£ x√¢y: M√†u b√¨nh th∆∞·ªùng + level badge xanh
  - Ch∆∞a x√¢y: Grayscale filter + level badge ƒë·ªè

### 8.2. Desktop-Only Experience
- **Platform Support**: Ch·ªâ h·ªó tr·ª£ m√°y t√≠nh ƒë·ªÉ b√†n v√† laptop
- **Screen Requirements**: ƒê·ªô ph√¢n gi·∫£i t·ªëi thi·ªÉu 1024x768
- **Mobile Detection**: T·ª± ƒë·ªông redirect thi·∫øt b·ªã mobile ƒë·∫øn `/not-implemented`
- **Optimized Layout**: 3 c·ªôt buildings ƒë∆∞·ª£c t·ªëi ∆∞u cho m√†n h√¨nh l·ªõn

### 8.3. Mobile Not Supported
- **Auto Detection**: JavaScript ki·ªÉm tra User Agent v√† screen size
- **Redirect Logic**: Mobile users ‚Üí `/not-implemented` page
- **Clear Messaging**: Th√¥ng b√°o r√µ r√†ng v·ªÅ y√™u c·∫ßu h·ªá th·ªëng
- **No Responsive CSS**: ƒê√£ lo·∫°i b·ªè to√†n b·ªô mobile responsive ƒë·ªÉ t·ªëi ∆∞u performance

---


## 12. Giao di·ªán & User Experience

### 12.1. Desktop-Only Design
- **Container**: Width 70% t·ªëi ∆∞u cho desktop/laptop
- **Grid System**: 3 c·ªôt buildings c·ªë ƒë·ªãnh cho m√†n h√¨nh l·ªõn
- **Navigation**: User Info & Navigation t√≠ch h·ª£p th√†nh m·ªôt bar
- **No Mobile Support**: Lo·∫°i b·ªè responsive CSS ƒë·ªÉ t·ªëi ∆∞u performance

### 12.2. Enhanced Navigation  
- **Integrated Bar**: User stats + navigation actions trong c√πng m·ªôt component
- **Direct Actions**: Th·ªã tr·∫•n, Nhi·ªám v·ª•, Chi·∫øn ƒë·∫•u, Kho ƒë·ªì, ƒêƒÉng xu·∫•t
- **Visual Feedback**: Button states v√† hover effects
- **Streamlined UX**: Lo·∫°i b·ªè Action Buttons duplicate

### 12.3. Visual Elements  
- **Modals**: W3.CSS modal system cho building upgrades
- **Toasts**: Th√¥ng b√°o success/error v·ªõi animations
- **Loading states**: Visual feedback cho API calls
- **Hover effects**: Smooth transitions v√† scale effects

### 12.4. Authentication UX
- **Smart redirects**: T·ª± ƒë·ªông ƒëi·ªÅu h∆∞·ªõng based on auth status
- **Session persistence**: Maintain login state across browser sessions
- **Error handling**: User-friendly error messages

### 12.5. Mobile Detection & Redirect
- **Auto Detection**: JavaScript ki·ªÉm tra device type v√† screen size
- **Graceful Fallback**: Redirect ƒë·∫øn `/not-implemented` v·ªõi th√¥ng b√°o r√µ r√†ng
- **System Requirements**: Hi·ªÉn th·ªã y√™u c·∫ßu h·ªá th·ªëng cho user

---

---


